<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Probability of Success with Co-Data • RBesT</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Probability of Success with Co-Data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">RBesT</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.8-0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/customizing_plots.html">Customizing RBesT plots</a></li>
    <li><a class="dropdown-item" href="../articles/introduction_normal.html">RBesT for a Normal Endpoint</a></li>
    <li><a class="dropdown-item" href="../articles/introduction.html">Getting started with RBesT (binary)</a></li>
    <li><a class="dropdown-item" href="../articles/PoS_codata.html">Probability of Success with Co-Data</a></li>
    <li><a class="dropdown-item" href="../articles/PoS_interim.html">Probability of Success at an Interim Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/variances_MAP.html">Meta-Analytic-Predictive Priors for Variances</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Novartis/RBesT/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Probability of Success with Co-Data</h1>
            <h3 data-toc-skip class="subtitle">Use of Co-Data in
Clinical Trails with RBesT</h3>
                        <h4 data-toc-skip class="author">Sebastian
Weber</h4>
            
            <h4 data-toc-skip class="date">2025-01-08</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/Novartis/RBesT/blob/v1.8-0/vignettes/articles/PoS_codata.Rmd" class="external-link"><code>vignettes/articles/PoS_codata.Rmd</code></a></small>
      <div class="d-none name"><code>PoS_codata.Rmd</code></div>
    </div>

    
    
<!-- To produce a html report, please execute in R -->
<!-- library(rmarkdown) -->
<!-- render("PoS_codata.Rmd") -->
<p>The probability of success is a very useful concept to assess the
chances of success of a trial while taking uncertainties into account.
In this document we briefly introduce the needed formal details,
describe an example data set and then demonstrate various ways of how
the probability of success concept can be applied to increasingly
complex data situations.</p>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The co-data concept has been introduced in [1]. It differs from the
use of historical data in that the approach makes use of contemporary
data. A meta-analytic-predictive (MAP) analysis assumes that historical
data is known at the time-point of specyfing the analysis and is as such
a retrospective summary of available data. The MAP prior is then
combined with the current trial data. A co-data approach extends this
sequential procedure to a meta-analytic-combined (MAC) analysis. In the
MAC approach all available data is analyzed in a single step - that is,
historical and concurrent data is combined in a single inference step.
Both approaches MAP and MAC yield exactly the same results as is
demonstrated in the appendix at the bottom. An example for a co-data
scenario in drug development is the simultaneous execution of twin phase
III trails for registriation. In such a setting, a futility analysis at
an interim analysis may take historical and all contemporary data into
account in a co-data approach. This example has been discussed in [1]
using the probability of success (PoS) as metric to assess futility at
an interim analysis and is discussed here in detail.</p>
<p>The key property of the probability of success metric is the
consideration of uncertainty in parameters conditional on available
data. In contrast, the conditional power (CP) calculates the frequency a
given experemintal design will be successful for a known value of the
parameters. For example, in a 1-sample experiment with a one-sided
success criterion the trial is successful if the collected data
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mi>N</mi></msub><annotation encoding="application/x-tex">y_N</annotation></semantics></math>
of sample size
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>N</mi><annotation encoding="application/x-tex">N</annotation></semantics></math>
exceeds some critical value
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mi>c</mi></msub><annotation encoding="application/x-tex">y_c</annotation></semantics></math>;
recall that the critical value
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mi>c</mi></msub><annotation encoding="application/x-tex">y_c</annotation></semantics></math>
is determined by the success criterion, prior and sample size when
evaluated. Assuming that the sampling model of the data is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>y</mi><mo stretchy="false" form="prefix">|</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">p(y|\theta)</annotation></semantics></math>,
then</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><msub><mi>P</mi><mi>N</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>∫</mo><mi>I</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mi>N</mi></msub><mo>&gt;</mo><msub><mi>y</mi><mi>c</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="0.167em"></mspace><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mi>N</mi></msub><mo stretchy="false" form="prefix">|</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="0.167em"></mspace><mi>d</mi><msub><mi>y</mi><mi>N</mi></msub><mi>.</mi></mrow><annotation encoding="application/x-tex"> CP_N(\theta) = \int I(y_N  &gt; y_c) \, p(y_N|\theta) \, dy_N.</annotation></semantics></math></p>
<p>The integration over the data
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mi>N</mi></msub><annotation encoding="application/x-tex">y_N</annotation></semantics></math>
comprises all possible outcomes of the trial. Note that before the start
of the trial,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><msub><mi>P</mi><mi>N</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>θ</mi><mn>0</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">CP_N(\theta_0)</annotation></semantics></math>
is the type I error rate under the conventional null hypothesis
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi><mo>=</mo><msub><mi>θ</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">\theta=\theta_0</annotation></semantics></math>)
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><msub><mi>P</mi><mi>N</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>θ</mi><mi>a</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">CP_N(\theta_a)</annotation></semantics></math>
the power of the trial under the alternative
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi><mo>=</mo><msub><mi>θ</mi><mi>a</mi></msub></mrow><annotation encoding="application/x-tex">\theta=\theta_a</annotation></semantics></math>).
At an interim analysis at sample size
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mi>I</mi></msub><annotation encoding="application/x-tex">n_I</annotation></semantics></math>,
the conditional power is then evaluated conditional on the observed data
so far (the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mi>I</mi></msub><annotation encoding="application/x-tex">n_I</annotation></semantics></math>
measurements) while the remaining sample size
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo>−</mo><msub><mi>n</mi><mi>I</mi></msub></mrow><annotation encoding="application/x-tex">N-n_I</annotation></semantics></math>)
is random and distributed according to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>y</mi><mo stretchy="false" form="prefix">|</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">p(y|\theta)</annotation></semantics></math>
with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation></semantics></math>
set to some known value,</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><msub><mi>P</mi><mrow><mi>N</mi><mo>−</mo><msub><mi>n</mi><mi>I</mi></msub></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>θ</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>y</mi><msub><mi>n</mi><mi>I</mi></msub></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>∫</mo><mi>I</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><msub><mi>n</mi><mi>I</mi></msub></msub><mo>+</mo><msub><mi>y</mi><mrow><mi>N</mi><mo>−</mo><msub><mi>n</mi><mi>I</mi></msub></mrow></msub><mo>=</mo><msub><mi>y</mi><mi>N</mi></msub><mo>&gt;</mo><msub><mi>y</mi><mi>c</mi></msub><mo stretchy="false" form="prefix">|</mo><msub><mi>y</mi><msub><mi>n</mi><mi>I</mi></msub></msub><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="0.167em"></mspace><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>N</mi><mo>−</mo><msub><mi>n</mi><mi>I</mi></msub></mrow></msub><mo stretchy="false" form="prefix">|</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="0.167em"></mspace><mi>d</mi><msub><mi>y</mi><mrow><mi>N</mi><mo>−</mo><msub><mi>n</mi><mi>I</mi></msub></mrow></msub><mi>.</mi></mrow><annotation encoding="application/x-tex"> CP_{N-n_I}(\theta|y_{n_I}) = \int I(y_{n_I} + y_{N-n_I} = y_N &gt; y_c|y_{n_I}) \, p(y_{N-n_I}|\theta) \, dy_{N-n_I}.</annotation></semantics></math></p>
<p>The known value can be set equal to the observed point estimate at
the interim,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><msub><mi>P</mi><mrow><mi>N</mi><mo>−</mo><msub><mi>n</mi><mi>I</mi></msub></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mi>θ</mi><mo accent="true">̂</mo></mover><mi>I</mi></msub><mo stretchy="false" form="prefix">|</mo><msub><mi>y</mi><msub><mi>n</mi><mi>I</mi></msub></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">CP_{N-n_I}(\hat{\theta}_{I}|y_{n_I})</annotation></semantics></math>,
or to the assumed true alternative,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><msub><mi>P</mi><mrow><mi>N</mi><mo>−</mo><msub><mi>n</mi><mi>I</mi></msub></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>θ</mi><mi>a</mi></msub><mo stretchy="false" form="prefix">|</mo><msub><mi>y</mi><msub><mi>n</mi><mi>I</mi></msub></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">CP_{N-n_I}(\theta_a|y_{n_I})</annotation></semantics></math>,
used to plan the trial.</p>
<p>The probability of success in contrast assigns
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation></semantics></math>
a distribution and marginalizes the conditional power over this
distribution. In absence of additional trial external information this
distribution is the posterior for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>θ</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>y</mi><msub><mi>n</mi><mi>I</mi></msub></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">p(\theta|y_{n_I})</annotation></semantics></math>
obtained from the prior for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">p(\theta)</annotation></semantics></math>
and the data collected up to the interim,</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mi>o</mi><msub><mi>S</mi><mi>I</mi></msub><mo>=</mo><mo>∫</mo><mi>C</mi><msub><mi>P</mi><mrow><mi>N</mi><mo>−</mo><msub><mi>n</mi><mi>I</mi></msub></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>θ</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>y</mi><msub><mi>n</mi><mi>I</mi></msub></msub><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="0.167em"></mspace><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>θ</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>y</mi><msub><mi>n</mi><mi>I</mi></msub></msub><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="0.167em"></mspace><mi>d</mi><mi>θ</mi><mi>.</mi></mrow><annotation encoding="application/x-tex"> PoS_I = \int CP_{N-n_I}(\theta|y_{n_I}) \, p(\theta|y_{n_I}) \, d\theta.</annotation></semantics></math></p>
<p>However, our knowledge about
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation></semantics></math>
can be refined if other data-sources like completed (historical) or
concurrent trials are available,</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mi>o</mi><msub><mi>S</mi><mrow><mi>I</mi><mo>,</mo><mi>H</mi><mo>,</mo><mi>.</mi><mi>.</mi><mi>.</mi></mrow></msub><mo>=</mo><mo>∫</mo><mi>C</mi><msub><mi>P</mi><mrow><mi>N</mi><mo>−</mo><msub><mi>n</mi><mi>I</mi></msub></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>θ</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>y</mi><msub><mi>n</mi><mi>I</mi></msub></msub><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="0.167em"></mspace><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>θ</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>y</mi><mi>I</mi></msub><mo>,</mo><msub><mi>y</mi><mi>H</mi></msub><mo>,</mo><mi>.</mi><mi>.</mi><mi>.</mi><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="0.167em"></mspace><mi>d</mi><mi>θ</mi><mi>.</mi></mrow><annotation encoding="application/x-tex"> PoS_{I,H,...} = \int CP_{N-n_I}(\theta|y_{n_I}) \, p(\theta|y_{I},y_{H},...) \, d\theta.</annotation></semantics></math></p>
<p>It is important to note that the conditional power is <em>always</em>
evaluated with respect to the trial data (and prior) only. Thus,
additional data-sources are not part of the analysis of the trial. In
practice this means that the probability of success is usually
calculated for a trial which uses non-informative priors, but at interim
we may use additional data-sources to refine our knowledge on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation></semantics></math>
which will not be part of the trial analysis.</p>
</div>
<div class="section level2">
<h2 id="example-data-scenario">Example Data Scenario<a class="anchor" aria-label="anchor" href="#example-data-scenario"></a>
</h2>
<p>In the following the hypothetical example as in [1] is discussed. The
assumed endpoint is time-to-event, which is analyzed using the normal
approximation of the log-rank statistic for comparing two groups. Under
a 1:1 randomization the standard error of the log-hazard ratio scales
with the number of events as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mi>/</mi><msqrt><msub><mi>N</mi><mrow><mi>e</mi><mi>v</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>s</mi></mrow></msub></msqrt></mrow><annotation encoding="application/x-tex">2/\sqrt{N_{events}}</annotation></semantics></math>.
This implies a corresponding sampling standard deviation of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>2</mn><annotation encoding="application/x-tex">2</annotation></semantics></math>,
which defines the unit information prior used later on in the analysis.
The historical data considered is a proof of concept and a phase II
trial. The twin phase III studies are event driven. Each trial stops
whenever a total of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>379</mn><annotation encoding="application/x-tex">379</annotation></semantics></math>
events is reached and an interim is planned whenever at least
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>150</mn><annotation encoding="application/x-tex">150</annotation></semantics></math>
events have occured. The assumed true hazard ratio used for the design
of the trial is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.8</mn><annotation encoding="application/x-tex">0.8</annotation></semantics></math>.</p>
<p>Example data:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trials</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  study <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PoC"</span>, <span class="st">"PhII"</span>, <span class="st">"PhIII_A"</span>, <span class="st">"PhIII_B"</span><span class="op">)</span>,</span>
<span>  deaths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">85</span>, <span class="fl">162</span>, <span class="fl">150</span><span class="op">)</span>,</span>
<span>  HR <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.7</span>, <span class="fl">0.75</span>, <span class="fl">0.83</span>, <span class="fl">0.78</span><span class="op">)</span>,</span>
<span>  stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">## under the normal approximation of the log-HR, the sampling sd is 2</span></span>
<span><span class="co">## such that the standard errors are sqrt(4/events)</span></span>
<span><span class="va">trials</span> <span class="op">&lt;-</span> <span class="va">trials</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>logHR <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">HR</span><span class="op">)</span>, sem <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">4</span> <span class="op">/</span> <span class="va">deaths</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">trials</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">study</th>
<th align="right">deaths</th>
<th align="right">HR</th>
<th align="right">logHR</th>
<th align="right">sem</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">PoC</td>
<td align="right">8</td>
<td align="right">0.70</td>
<td align="right">-0.36</td>
<td align="right">0.71</td>
</tr>
<tr class="even">
<td align="left">PhII</td>
<td align="right">85</td>
<td align="right">0.75</td>
<td align="right">-0.29</td>
<td align="right">0.22</td>
</tr>
<tr class="odd">
<td align="left">PhIII_A</td>
<td align="right">162</td>
<td align="right">0.83</td>
<td align="right">-0.19</td>
<td align="right">0.16</td>
</tr>
<tr class="even">
<td align="left">PhIII_B</td>
<td align="right">150</td>
<td align="right">0.78</td>
<td align="right">-0.25</td>
<td align="right">0.16</td>
</tr>
</tbody>
</table>
<p>The remaining outline of the vignette is to first evaluate the design
properties of the trials, then calculate the probability of success at
interim for the A trial only (using only trial A data). Next, the
probability of success is calculated using in addition the historical
data. Subsequently, the probability of success for trial A is calculated
also using the historical data <em>and</em> the concurrent phase III
data of trial B. Finally, the overall probability of success is
calculated, which is defined by the joint success of both trials. In the
appendix the equivalence of the MAP and MAC approach is
demonstrated.</p>
</div>
<div class="section level2">
<h2 id="statistical-trial-design-considerations">Statistical Trial Design Considerations<a class="anchor" aria-label="anchor" href="#statistical-trial-design-considerations"></a>
</h2>
<p>Key design choices:</p>
<ul>
<li>time-to-event endpoint</li>
<li>phase III trials stop at target # of events 379</li>
<li>null hypothesis of no difference in HR,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>θ</mi><mn>0</mn></msub><mo>=</mo><mn>1.0</mn></mrow><annotation encoding="application/x-tex">\theta_0 = 1.0</annotation></semantics></math>
</li>
<li>one-sided
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>=</mo><mn>0.025</mn></mrow><annotation encoding="application/x-tex">\alpha = 0.025</annotation></semantics></math>
</li>
<li>alternative hypothesis assumes true HR of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>θ</mi><mi>a</mi></msub><mo>=</mo><mn>0.75</mn></mrow><annotation encoding="application/x-tex">\theta_a=0.75</annotation></semantics></math>
</li>
<li>interim when at least 150 events reached</li>
</ul>
<p>Historical data:</p>
<ul>
<li>promising internal PoC</li>
<li>promising phase II</li>
</ul>
<p>Co-data:</p>
<ul>
<li>two phase III trials run in parallel
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>⇒</mo><annotation encoding="application/x-tex">\Rightarrow</annotation></semantics></math>
each phase III trial is <em>concurrent</em> with the other</li>
</ul>
<p>Define design choices</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Nev</span> <span class="op">&lt;-</span> <span class="fl">379</span></span>
<span></span>
<span><span class="va">alt_HR</span> <span class="op">&lt;-</span> <span class="fl">0.75</span></span>
<span><span class="va">alt_logHR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">alt_HR</span><span class="op">)</span></span>
<span></span>
<span><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fl">0.025</span></span></code></pre></div>
<div class="section level3">
<h3 id="power-calculation">Power calculation<a class="anchor" aria-label="anchor" href="#power-calculation"></a>
</h3>
<p>Here we use the unit information prior as non-informative prior and
define it using the mean &amp; effective sample size (ESS)
specification:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">unit_inf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mixnorm.html">mixnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, sigma <span class="op">=</span> <span class="fl">2</span>, param <span class="op">=</span> <span class="st">"mn"</span><span class="op">)</span></span>
<span><span class="va">unit_inf</span></span></code></pre></div>
<pre><code><span><span class="co">## Univariate normal mixture</span></span>
<span><span class="co">## Reference scale: 2</span></span>
<span><span class="co">## Mixture Components:</span></span>
<span><span class="co">##   comp1</span></span>
<span><span class="co">## w 1    </span></span>
<span><span class="co">## m 0    </span></span>
<span><span class="co">## s 2</span></span></code></pre>
<p>Define conditional power for the overall trial:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">success_crit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/decision1S.html">decision1S</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">alpha</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="co">## let's print the defined criterion</span></span>
<span><span class="va">success_crit</span></span></code></pre></div>
<pre><code><span><span class="co">## 1 sample decision function</span></span>
<span><span class="co">## Conditions for acceptance:</span></span>
<span><span class="co">## P(theta &lt;= 0) &gt; 0.975</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">design</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/oc1S.html">oc1S</a></span><span class="op">(</span><span class="va">unit_inf</span>, <span class="va">Nev</span>, <span class="va">success_crit</span>, sigma <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>Under the alternative these design choices result in 80% power</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">design</span><span class="op">(</span><span class="va">alt_logHR</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.7986379</span></span></code></pre>
<p>The impact of the unit-information prior is minimal which can be seen
by comparing to the frequentist calculation:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/power.t.test.html" class="external-link">power.t.test</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">Nev</span>, delta <span class="op">=</span> <span class="op">-</span><span class="fl">1</span> <span class="op">*</span> <span class="va">alt_logHR</span>, sd <span class="op">=</span> <span class="fl">2</span>, type <span class="op">=</span> <span class="st">"one.sample"</span>, sig.level <span class="op">=</span> <span class="fl">0.025</span>, alternative <span class="op">=</span> <span class="st">"one.sided"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##      One-sample t test power calculation </span></span>
<span><span class="co">## </span></span>
<span><span class="co">##               n = 379</span></span>
<span><span class="co">##           delta = 0.2876821</span></span>
<span><span class="co">##              sd = 2</span></span>
<span><span class="co">##       sig.level = 0.025</span></span>
<span><span class="co">##           power = 0.7976343</span></span>
<span><span class="co">##     alternative = one.sided</span></span></code></pre>
<p>With RBesT we can explore the conditional power for a range of
alternatives:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>HR <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1.2</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">HR</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_function.html" class="external-link">stat_function</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="fu">compose</span><span class="op">(</span><span class="va">design</span>, <span class="va">log</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://mc-stan.org/bayesplot/reference/bayesplot-helpers.html" class="external-link">vline_at</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">alt_HR</span>, <span class="fl">1.0</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">alt_HR</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1.2</span>, by <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">theta</span><span class="op">[</span><span class="va">a</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Power for N ="</span>, <span class="va">Nev</span>, <span class="st">"events"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="PoS_codata_files/figure-html/unnamed-chunk-10-1.png" width="100%" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="critical-value">Critical value<a class="anchor" aria-label="anchor" href="#critical-value"></a>
</h3>
<p>The critical value determines at which observed logHR we
<em>just</em> conclude that the success criterion is fulfilled.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">design_crit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/decision1S_boundary.html">decision1S_boundary</a></span><span class="op">(</span><span class="va">unit_inf</span>, <span class="va">Nev</span>, <span class="va">success_crit</span>, sigma <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">design_crit</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] -0.2017185</span></span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">design_crit</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.8173249</span></span></code></pre>
<p>We can check this:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">success_crit</span><span class="op">(</span><span class="fu"><a href="../reference/postmix.html">postmix</a></span><span class="op">(</span><span class="va">unit_inf</span>, m <span class="op">=</span> <span class="va">design_crit</span>, n <span class="op">=</span> <span class="fl">379</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Using default prior reference scale 2</span></span></code></pre>
<pre><code><span><span class="co">## [1] 1</span></span></code></pre>
<p>Ok, when observing the critical value, we get a success.</p>
<p>Now, what if we observe a 1% worse result?</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">success_crit</span><span class="op">(</span><span class="fu"><a href="../reference/postmix.html">postmix</a></span><span class="op">(</span><span class="va">unit_inf</span>, m <span class="op">=</span> <span class="va">design_crit</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1.01</span><span class="op">)</span>, n <span class="op">=</span> <span class="fl">379</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Using default prior reference scale 2</span></span></code></pre>
<pre><code><span><span class="co">## [1] 0</span></span></code></pre>
<p>No success then
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>⇒</mo><annotation encoding="application/x-tex">\Rightarrow</annotation></semantics></math>
this is the critical boundary value.</p>
</div>
</div>
<div class="section level2">
<h2 id="pos-at-interim-for-phase-iii-trial-a-only">PoS at interim for phase III trial A only<a class="anchor" aria-label="anchor" href="#pos-at-interim-for-phase-iii-trial-a-only"></a>
</h2>
<div class="section level3">
<h3 id="no-use-of-historical-information">No use of historical information<a class="anchor" aria-label="anchor" href="#no-use-of-historical-information"></a>
</h3>
<p>Posterior of treatment effect at interim. The trial uses a
non-informative prior for the treatment effect:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interim_A</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/postmix.html">postmix</a></span><span class="op">(</span><span class="va">unit_inf</span>, m <span class="op">=</span> <span class="va">trials</span><span class="op">$</span><span class="va">logHR</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, se <span class="op">=</span> <span class="va">trials</span><span class="op">$</span><span class="va">sem</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">interim_A</span></span></code></pre></div>
<pre><code><span><span class="co">## Univariate normal mixture</span></span>
<span><span class="co">## Reference scale: 2</span></span>
<span><span class="co">## Mixture Components:</span></span>
<span><span class="co">##   comp1     </span></span>
<span><span class="co">## w  1.0000000</span></span>
<span><span class="co">## m -0.1851865</span></span>
<span><span class="co">## s  0.1566521</span></span></code></pre>
<p>Now we are interested in the PoS at trial completion. The prior to
use for the analysis of the second half is given by the data collected
so far.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interim_pos_A</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pos1S.html">pos1S</a></span><span class="op">(</span><span class="va">interim_A</span>, <span class="va">Nev</span> <span class="op">-</span> <span class="va">trials</span><span class="op">$</span><span class="va">deaths</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">success_crit</span>, sigma <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>The returned function can now calculate the PoS assuming any
distribution on the treatment effect. In case we do not use any
historical information, then this is just the interim posterior:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">interim_pos_A</span><span class="op">(</span><span class="va">interim_A</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.4465623</span></span></code></pre>
<p>The above command integrates the <em>conditional power</em> over the
uncertainty which we have about the treatment effect as defined above
for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mi>o</mi><msub><mi>S</mi><mi>I</mi></msub></mrow><annotation encoding="application/x-tex">PoS_I</annotation></semantics></math>.</p>
<p>The conditional power and the operating characteristics of a trial
coincide whenever we do not condition on any observed data. The key
difference of the conditional power as compared to the probability of
success is that it assumes a known value for the parameter of interest.
This can be seen as follows: First define the conditional power which is
conditional on the observed data,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><msub><mi>P</mi><mrow><mi>N</mi><mo>−</mo><msub><mi>n</mi><mi>I</mi></msub></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>θ</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>y</mi><msub><mi>n</mi><mi>I</mi></msub></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">CP_{N-n_I}(\theta|y_{n_I})</annotation></semantics></math>:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interim_oc_A</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/oc1S.html">oc1S</a></span><span class="op">(</span><span class="va">interim_A</span>, <span class="va">Nev</span> <span class="op">-</span> <span class="va">trials</span><span class="op">$</span><span class="va">deaths</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">success_crit</span>, sigma <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>The conditional power assuming the alternative is true (a HR of
0.75):</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">interim_oc_A</span><span class="op">(</span><span class="va">alt_logHR</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.708769</span></span></code></pre>
<p>In case there is no uncertainty of the treatment effect (here
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>e</mi><mo>=</mo><msup><mn>10</mn><mo>−</mo></msup><mn>4</mn></mrow><annotation encoding="application/x-tex">se=10^-4</annotation></semantics></math>),
then this result agrees with the probability of success calculation:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">interim_pos_A</span><span class="op">(</span><span class="fu"><a href="../reference/mixnorm.html">mixnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">alt_logHR</span>, <span class="fl">1E-4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.7087689</span></span></code></pre>
<p>For trial B the calculation is:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interim_B</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/postmix.html">postmix</a></span><span class="op">(</span><span class="va">unit_inf</span>, m <span class="op">=</span> <span class="va">trials</span><span class="op">$</span><span class="va">logHR</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>, se <span class="op">=</span> <span class="va">trials</span><span class="op">$</span><span class="va">sem</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">interim_pos_B</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pos1S.html">pos1S</a></span><span class="op">(</span><span class="va">interim_B</span>, <span class="va">Nev</span> <span class="op">-</span> <span class="va">trials</span><span class="op">$</span><span class="va">deaths</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>, <span class="va">success_crit</span>, sigma <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu">interim_pos_B</span><span class="op">(</span><span class="va">interim_B</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.6411569</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="use-of-historical-information---map-approach">Use of historical information - MAP approach<a class="anchor" aria-label="anchor" href="#use-of-historical-information---map-approach"></a>
</h3>
<p>However, we have historical information of which we can take
advantage at the interim for a better informed decision.</p>
<p>Our data before the phase III trials includes the PoC and the phase
II trial. We now derive from these a MAP prior; recall that the MAP
prior is the prediction of the log-hazard ratio of a future trial:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">base</span> <span class="op">&lt;-</span> <span class="va">trials</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">342345</span><span class="op">)</span></span>
<span><span class="va">base_map_mc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gMAP.html">gMAP</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">logHR</span>, <span class="va">sem</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">study</span>,</span>
<span>  family <span class="op">=</span> <span class="va">gaussian</span>,</span>
<span>  data <span class="op">=</span> <span class="va">base</span>,</span>
<span>  weights <span class="op">=</span> <span class="va">deaths</span>,</span>
<span>  tau.dist <span class="op">=</span> <span class="st">"HalfNormal"</span>, tau.prior <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  beta.prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/forest_plot.html">forest_plot</a></span><span class="op">(</span><span class="va">base_map_mc</span>, est <span class="op">=</span> <span class="st">"MAP"</span><span class="op">)</span></span></code></pre></div>
<p><img src="PoS_codata_files/figure-html/unnamed-chunk-21-1.png" width="100%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">base_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/automixfit.html">automixfit</a></span><span class="op">(</span><span class="va">base_map_mc</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">base_map</span><span class="op">)</span><span class="op">$</span><span class="va">mix</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="PoS_codata_files/figure-html/unnamed-chunk-21-2.png" width="100%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">base_map</span></span></code></pre></div>
<pre><code><span><span class="co">## EM for Normal Mixture Model</span></span>
<span><span class="co">## Log-Likelihood = -3110.728</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Univariate normal mixture</span></span>
<span><span class="co">## Reference scale: 2</span></span>
<span><span class="co">## Mixture Components:</span></span>
<span><span class="co">##   comp1      comp2      comp3     </span></span>
<span><span class="co">## w  0.6094510  0.2591800  0.1313691</span></span>
<span><span class="co">## m -0.2943573 -0.2783962 -0.3331379</span></span>
<span><span class="co">## s  0.2990546  0.6500315  1.1889177</span></span></code></pre>
<p>At the interim we have even more knowledge available on the treatment
effect through the interim data itself which we can include into the MAP
prior:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interim_A_combined</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/postmix.html">postmix</a></span><span class="op">(</span><span class="va">base_map</span>, m <span class="op">=</span> <span class="va">trials</span><span class="op">$</span><span class="va">logHR</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, se <span class="op">=</span> <span class="va">trials</span><span class="op">$</span><span class="va">sem</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>The PoS for this posterior at interim (representing historical
<em>and</em> interim data collected) is:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">interim_pos_A</span><span class="op">(</span><span class="va">interim_A_combined</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.4850564</span></span></code></pre>
<p>Note that we have not redefined <code>interim_pos_A</code>, such that
this calculates the PoS for the phase III A trial taking into account
that the final analysis will use a non-informative prior.</p>
<p>For trial B the calculation is:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interim_B_combined</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/postmix.html">postmix</a></span><span class="op">(</span><span class="va">base_map</span>, m <span class="op">=</span> <span class="va">trials</span><span class="op">$</span><span class="va">logHR</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>, se <span class="op">=</span> <span class="va">trials</span><span class="op">$</span><span class="va">sem</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu">interim_pos_B</span><span class="op">(</span><span class="va">interim_B_combined</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.6686476</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="use-of-historical-information---mac-approach">Use of historical information - MAC approach<a class="anchor" aria-label="anchor" href="#use-of-historical-information---mac-approach"></a>
</h3>
<p>However, there is even more information which can be used here, since
the phase III result of trial B is also available:</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interim_map_mc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">base_map_mc</span>, data <span class="op">=</span> <span class="va">trials</span><span class="op">)</span></span></code></pre></div>
<p>Now the trial B specific posterior at interim is</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">kable</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">interim_map_mc</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">2.5%</th>
<th align="right">50%</th>
<th align="right">97.5%</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">PoC</td>
<td align="right">-0.244</td>
<td align="right">0.238</td>
<td align="right">-0.795</td>
<td align="right">-0.238</td>
<td align="right">0.234</td>
</tr>
<tr class="even">
<td align="left">PhII</td>
<td align="right">-0.252</td>
<td align="right">0.149</td>
<td align="right">-0.556</td>
<td align="right">-0.251</td>
<td align="right">0.042</td>
</tr>
<tr class="odd">
<td align="left">PhIII_A</td>
<td align="right">-0.214</td>
<td align="right">0.126</td>
<td align="right">-0.462</td>
<td align="right">-0.216</td>
<td align="right">0.035</td>
</tr>
<tr class="even">
<td align="left">PhIII_B</td>
<td align="right">-0.237</td>
<td align="right">0.126</td>
<td align="right">-0.489</td>
<td align="right">-0.237</td>
<td align="right">0.011</td>
</tr>
</tbody>
</table>
<p>which we can extract as:</p>
<ol style="list-style-type: decimal">
<li>obtain posterior (which we restrict to the first 4 columns)</li>
</ol>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interim_map_post</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">interim_map_mc</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">interim_map_post</span><span class="op">)</span> <span class="co"># posterior is given as matrix: iteration x parameter</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 4000    4</span></span></code></pre>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">interim_map_post</span>, n <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##           parameters</span></span>
<span><span class="co">## iterations   theta[1]   theta[2]   theta[3]    theta[4]</span></span>
<span><span class="co">##       [1,]  0.5793535 -0.4054789  0.1303989 -0.30952085</span></span>
<span><span class="co">##       [2,] -0.3457577 -0.3818282 -0.3105840 -0.32644175</span></span>
<span><span class="co">##       [3,] -0.1232030 -0.1211176 -0.1414171 -0.08166256</span></span></code></pre>
<ol start="2" style="list-style-type: decimal">
<li>turn MCMC posterior sample into parametric mixture</li>
</ol>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interim_A_allcombined</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/automixfit.html">automixfit</a></span><span class="op">(</span><span class="va">interim_map_post</span><span class="op">[</span>, <span class="st">"theta[3]"</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>and finally evaluate the PoS</li>
</ol>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">interim_pos_A</span><span class="op">(</span><span class="va">interim_A_allcombined</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.5030811</span></span></code></pre>
<p>which aligns with the published result under the assumption of full
exchangeability.</p>
<p>For trial B computations are:</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interim_B_allcombined</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/automixfit.html">automixfit</a></span><span class="op">(</span><span class="va">interim_map_post</span><span class="op">[</span>, <span class="st">"theta[4]"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu">interim_pos_B</span><span class="op">(</span><span class="va">interim_B_allcombined</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.6415822</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="differential-discounting">Differential discounting<a class="anchor" aria-label="anchor" href="#differential-discounting"></a>
</h2>
<p>Differential discounting allows to weight different data-sources
differently. For example, we may assume greater heterogeneity for the
historical data in comparison to the twin phase III trials.</p>
<p>Assign data to historical (2) and concurrent data strata (1):</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trials</span> <span class="op">&lt;-</span> <span class="va">trials</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>stratum <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">trials</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">study</th>
<th align="right">deaths</th>
<th align="right">HR</th>
<th align="right">logHR</th>
<th align="right">sem</th>
<th align="right">stratum</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">PoC</td>
<td align="right">8</td>
<td align="right">0.70</td>
<td align="right">-0.36</td>
<td align="right">0.71</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">PhII</td>
<td align="right">85</td>
<td align="right">0.75</td>
<td align="right">-0.29</td>
<td align="right">0.22</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">PhIII_A</td>
<td align="right">162</td>
<td align="right">0.83</td>
<td align="right">-0.19</td>
<td align="right">0.16</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">PhIII_B</td>
<td align="right">150</td>
<td align="right">0.78</td>
<td align="right">-0.25</td>
<td align="right">0.16</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">435345</span><span class="op">)</span></span>
<span><span class="va">interim_diff_map_mc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gMAP.html">gMAP</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">logHR</span>, <span class="va">sem</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">study</span>,</span>
<span>  tau.strata <span class="op">=</span> <span class="va">stratum</span>,</span>
<span>  family <span class="op">=</span> <span class="va">gaussian</span>,</span>
<span>  data <span class="op">=</span> <span class="va">trials</span>,</span>
<span>  weights <span class="op">=</span> <span class="va">deaths</span>,</span>
<span>  tau.dist <span class="op">=</span> <span class="st">"HalfNormal"</span>, tau.prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  beta.prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">interim_diff_map_post</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">interim_diff_map_mc</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span>
<span></span>
<span><span class="va">interim_A_diff_allcombined</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/automixfit.html">automixfit</a></span><span class="op">(</span><span class="va">interim_diff_map_post</span><span class="op">[</span>, <span class="st">"theta[3]"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">interim_B_diff_allcombined</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/automixfit.html">automixfit</a></span><span class="op">(</span><span class="va">interim_diff_map_post</span><span class="op">[</span>, <span class="st">"theta[4]"</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">interim_pos_A</span><span class="op">(</span><span class="va">interim_A_diff_allcombined</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.493427</span></span></code></pre>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">interim_pos_B</span><span class="op">(</span><span class="va">interim_B_diff_allcombined</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.6394128</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="pos-for-both-phase-iii-trials-being-successful">PoS for both phase III trials being successful<a class="anchor" aria-label="anchor" href="#pos-for-both-phase-iii-trials-being-successful"></a>
</h2>
<p>So far we have only calculated the individual PoS per trial, but more
interesting is the <em>overall</em> PoS for both trials being
successful.</p>
<p>Recall, the PoS is the conditional power integrated over an assumed
true effect distribution. Hence, we had for trial A:</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">interim_pos_A</span><span class="op">(</span><span class="va">interim_A</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.4465623</span></span></code></pre>
<p>As explained, the conditional power is the operating characerstic of
a design when conditioning on the already observed data:</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interim_oc_A</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/oc1S.html">oc1S</a></span><span class="op">(</span><span class="va">interim_A</span>, <span class="va">Nev</span> <span class="op">-</span> <span class="va">trials</span><span class="op">$</span><span class="va">deaths</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">success_crit</span>, sigma <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>The PoS is then the integral of the conditional power over the
parameter space
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation></semantics></math>
representing our knowledge. This integral can be evaluated in a
Monte-Carlo (MC) approach as</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mi>o</mi><msub><mi>S</mi><mi>I</mi></msub><mo>=</mo><mo>∫</mo><mi>C</mi><msub><mi>P</mi><mrow><mi>N</mi><mo>−</mo><msub><mi>n</mi><mi>I</mi></msub></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>θ</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>y</mi><msub><mi>n</mi><mi>I</mi></msub></msub><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="0.167em"></mspace><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>θ</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>y</mi><msub><mi>n</mi><mi>I</mi></msub></msub><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="0.167em"></mspace><mi>d</mi><mi>θ</mi><mo>≈</mo><mfrac><mn>1</mn><mi>S</mi></mfrac><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>S</mi></munderover><mi>C</mi><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>θ</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex"> PoS_I = \int CP_{N-n_I}(\theta|y_{n_I}) \, p(\theta|y_{n_I}) \,
d\theta \approx \frac{1}{S} \sum_{i=1}^S CP(\theta_i),</annotation></semantics></math></p>
<p>whenever we have a sample of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>θ</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>y</mi><msub><mi>n</mi><mi>I</mi></msub></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">p(\theta|y_{n_I})</annotation></semantics></math>
of size
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>S</mi><annotation encoding="application/x-tex">S</annotation></semantics></math>…
which we have:</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interim_A_samp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mix.html">rmix</a></span><span class="op">(</span><span class="va">interim_A</span>, <span class="fl">1E4</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu">interim_oc_A</span><span class="op">(</span><span class="va">interim_A_samp</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.4479449</span></span></code></pre>
<p>This is an MC approach to calculating the PoS.</p>
<p>When now considering the probability for both trials being successful
we have to perform an MC integration over the joint density
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>θ</mi><mi>A</mi></msub><mo>,</mo><msub><mi>θ</mi><mi>B</mi></msub><mo stretchy="false" form="prefix">|</mo><msub><mi>y</mi><msub><mi>n</mi><msub><mi>I</mi><mi>A</mi></msub></msub></msub><mo>,</mo><msub><mi>y</mi><msub><mi>n</mi><msub><mi>I</mi><mi>B</mi></msub></msub></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">p(\theta_A,\theta_B|y_{n_{I_A}},y_{n_{I_B}})</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>P</mi><mi>o</mi><mi>S</mi></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mo>∬</mo><mi>C</mi><msub><mi>P</mi><mrow><mi>N</mi><mo>−</mo><msub><mi>n</mi><msub><mi>I</mi><mi>A</mi></msub></msub></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>θ</mi><mi>A</mi></msub><mo stretchy="false" form="prefix">|</mo><msub><mi>y</mi><msub><mi>n</mi><msub><mi>I</mi><mi>A</mi></msub></msub></msub><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="0.167em"></mspace><mi>C</mi><msub><mi>P</mi><mrow><mi>N</mi><mo>−</mo><msub><mi>n</mi><msub><mi>I</mi><mi>B</mi></msub></msub></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>θ</mi><mi>B</mi></msub><mo stretchy="false" form="prefix">|</mo><msub><mi>y</mi><msub><mi>n</mi><msub><mi>I</mi><mi>B</mi></msub></msub></msub><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="0.167em"></mspace><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>θ</mi><mi>A</mi></msub><mo>,</mo><msub><mi>θ</mi><mi>B</mi></msub><mo stretchy="false" form="prefix">|</mo><msub><mi>y</mi><msub><mi>n</mi><msub><mi>I</mi><mi>A</mi></msub></msub></msub><mo>,</mo><msub><mi>y</mi><msub><mi>n</mi><msub><mi>I</mi><mi>B</mi></msub></msub></msub><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="0.167em"></mspace><mi>d</mi><msub><mi>θ</mi><mi>A</mi></msub><mi>d</mi><msub><mi>θ</mi><mi>B</mi></msub></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>≈</mo><mfrac><mn>1</mn><mi>S</mi></mfrac><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>S</mi></munderover><mi>C</mi><msub><mi>P</mi><mrow><mi>N</mi><mo>−</mo><msub><mi>n</mi><msub><mi>I</mi><mi>A</mi></msub></msub></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>θ</mi><mrow><mi>A</mi><mo>,</mo><mi>i</mi></mrow></msub><mo stretchy="false" form="prefix">|</mo><msub><mi>y</mi><msub><mi>n</mi><msub><mi>I</mi><mi>A</mi></msub></msub></msub><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="0.167em"></mspace><mi>C</mi><msub><mi>P</mi><mrow><mi>N</mi><mo>−</mo><msub><mi>n</mi><msub><mi>I</mi><mi>B</mi></msub></msub></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>θ</mi><mrow><mi>B</mi><mo>,</mo><mi>i</mi></mrow></msub><mo stretchy="false" form="prefix">|</mo><msub><mi>y</mi><msub><mi>n</mi><msub><mi>I</mi><mi>B</mi></msub></msub></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
PoS &amp;= \iint CP_{N-n_{I_A}}(\theta_A|y_{n_{I_A}}) \,
CP_{N-n_{I_B}}(\theta_B|y_{n_{I_B}})\,
p(\theta_A,\theta_B|y_{n_{I_A}},y_{n_{I_B}}) \, d\theta_A d\theta_B \\
&amp; \approx
\frac{1}{S} \sum_{i=1}^S CP_{N-n_{I_A}}(\theta_{A,i}|y_{n_{I_A}}) \,
CP_{N-n_{I_B}}(\theta_{B,i}|y_{n_{I_B}}).
\end{aligned}
</annotation></semantics></math></p>
<p>Thus we need to also get the conditional power for trial B at
interim…</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interim_oc_B</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/oc1S.html">oc1S</a></span><span class="op">(</span><span class="va">interim_B</span>, <span class="va">Nev</span> <span class="op">-</span> <span class="va">trials</span><span class="op">$</span><span class="va">deaths</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>, <span class="va">success_crit</span>, sigma <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>…and integrate over the posterior samples (differential discounting
case)</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu">interim_oc_A</span><span class="op">(</span><span class="va">interim_diff_map_post</span><span class="op">[</span>, <span class="st">"theta[3]"</span><span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="fu">interim_oc_B</span><span class="op">(</span><span class="va">interim_diff_map_post</span><span class="op">[</span>, <span class="st">"theta[4]"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.3452887</span></span></code></pre>
<p>which is slightly larger than assuming independence:</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">interim_pos_A</span><span class="op">(</span><span class="va">interim_A</span><span class="op">)</span> <span class="op">*</span> <span class="fu">interim_pos_B</span><span class="op">(</span><span class="va">interim_B</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.2863165</span></span></code></pre>
<p>This is due to dependence of the posteriors</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">interim_diff_map_post</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"theta[3]"</span>, <span class="st">"theta[4]"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##           theta[3]  theta[4]</span></span>
<span><span class="co">## theta[3] 1.0000000 0.3187079</span></span>
<span><span class="co">## theta[4] 0.3187079 1.0000000</span></span></code></pre>
<p>For the full exchangeability case we have</p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu">interim_oc_A</span><span class="op">(</span><span class="va">interim_map_post</span><span class="op">[</span>, <span class="st">"theta[3]"</span><span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="fu">interim_oc_B</span><span class="op">(</span><span class="va">interim_map_post</span><span class="op">[</span>, <span class="st">"theta[4]"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.3521087</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>We have now calculated with increasing complexity the probability of
success for various data constellations. As new trials are only
conducted whenever previous trial results were positive, it is important
to take note of the potential selection bias. Moreover, adding more
historical data sources in this situation will likely increase the
probability of success as illustrated by this summary of our preceding
calculations.</p>
<p>Phase III trial A:</p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## only interim data of trial A</span></span>
<span><span class="fu">interim_pos_A</span><span class="op">(</span><span class="va">interim_A</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.4465623</span></span></code></pre>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## in addition with prior historical data PoC &amp; phase II data</span></span>
<span><span class="fu">interim_pos_A</span><span class="op">(</span><span class="va">interim_A_combined</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.4850564</span></span></code></pre>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## finally with the interim data of the phase III B</span></span>
<span><span class="fu">interim_pos_A</span><span class="op">(</span><span class="va">interim_A_allcombined</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.5030811</span></span></code></pre>
<p>Phase III trial B:</p>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## only interim data of trial B</span></span>
<span><span class="fu">interim_pos_B</span><span class="op">(</span><span class="va">interim_B</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.6411569</span></span></code></pre>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## in addition with prior historical data PoC &amp; phase II data</span></span>
<span><span class="fu">interim_pos_B</span><span class="op">(</span><span class="va">interim_B_combined</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.6686476</span></span></code></pre>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## finally with the interim data of the phase III A</span></span>
<span><span class="fu">interim_pos_B</span><span class="op">(</span><span class="va">interim_B_allcombined</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.6415822</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="appendix-map-and-mac-equivalence">Appendix: MAP and MAC equivalence<a class="anchor" aria-label="anchor" href="#appendix-map-and-mac-equivalence"></a>
</h2>
<p>In the preceeding sections we have used MAP and MAC equivalence
already. The proof for the equivalence is presented reference in [2].
The formal deriavtion is shown at the end of this section</p>
<p>While MAP and MAC provide the exact same results, the difference is a
sequential vs a joint analysis as (see also [2]):</p>
<ol style="list-style-type: decimal">
<li>MAP: Summarize historical information as MAP and then update the MAP
with the trial result (MCMC, then <code>postmix</code>).</li>
<li>MAC: Directly summarize historical information and trial result in a
single step (only MCMC on all data).</li>
</ol>
<p>The two results above using MAP and MAC did not line up. The reason
here is that the MAP approach used the historical data and the phase III
trial A interim data only. In contrast, the MAC approach used the
historical data and interim phase III data of both trials. To show the
equivalence we need to align this mismatch of used data.</p>
<p>Run <code>gMAP</code> with base data and produce a large MCMC sample
(10 chains) to get a very high precision.</p>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">base_map_mc_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gMAP.html">gMAP</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">logHR</span>, <span class="va">sem</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">study</span>,</span>
<span>  family <span class="op">=</span> <span class="va">gaussian</span>,</span>
<span>  data <span class="op">=</span> <span class="va">base</span>,</span>
<span>  weights <span class="op">=</span> <span class="va">deaths</span>,</span>
<span>  tau.dist <span class="op">=</span> <span class="st">"HalfNormal"</span>, tau.prior <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  beta.prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  chains <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">is_CRAN</span>, <span class="fl">2</span>, <span class="fl">20</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Force an accurate fit with 5 components:</p>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">base_map_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mixfit.html">mixfit</a></span><span class="op">(</span><span class="va">base_map_mc_2</span>, Nc <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">base_map_2</span></span></code></pre></div>
<pre><code><span><span class="co">## EM for Normal Mixture Model</span></span>
<span><span class="co">## Log-Likelihood = -15088.42</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Univariate normal mixture</span></span>
<span><span class="co">## Reference scale: 2</span></span>
<span><span class="co">## Mixture Components:</span></span>
<span><span class="co">##   comp1       comp2       comp3       comp4       comp5      </span></span>
<span><span class="co">## w  0.40929935  0.20586574  0.18866513  0.12833707  0.06783271</span></span>
<span><span class="co">## m -0.28173830 -0.64782890  0.06087094  0.16129924 -1.05921673</span></span>
<span><span class="co">## s  0.22707579  0.32358363  0.33140706  0.86765455  0.73553054</span></span></code></pre>
<p>Now, combine the MAP prior (representing historical knowledge) with
the interim data of trial A:</p>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interim_A_combined_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/postmix.html">postmix</a></span><span class="op">(</span><span class="va">base_map_2</span>, m <span class="op">=</span> <span class="va">trials</span><span class="op">$</span><span class="va">logHR</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, se <span class="op">=</span> <span class="va">trials</span><span class="op">$</span><span class="va">sem</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<ol style="list-style-type: decimal">
<li>Run the respective MAC analysis (thus we need historical data +
phase III A trial, but excluding the phase III B data):</li>
</ol>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interim_map_mc_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">base_map_mc_2</span>, data <span class="op">=</span> <span class="va">trials</span><span class="op">[</span><span class="op">-</span><span class="fl">4</span>, <span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: There were 3 divergent transitions after warmup. See</span></span>
<span><span class="co">## https://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup</span></span>
<span><span class="co">## to find out why this is a problem and how to eliminate them.</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Examine the pairs() plot to diagnose sampling problems</span></span></code></pre>
<pre><code><span><span class="co">## Warning in gMAP(formula = cbind(logHR, sem) ~ 1 | study, family = gaussian, : In total 3 divergent transitions occured during the sampling phase.</span></span>
<span><span class="co">## Please consider increasing adapt_delta closer to 1 with the following command prior to gMAP:</span></span>
<span><span class="co">## options(RBesT.MC.control=list(adapt_delta=0.999))</span></span></code></pre>
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interim_map_post_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">interim_map_mc_2</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>turn MCMC posterior sample into parametric mixture</li>
</ol>
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interim_A_allcombined_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mixfit.html">mixfit</a></span><span class="op">(</span><span class="va">interim_map_post_2</span><span class="op">[</span>, <span class="st">"theta[3]"</span><span class="op">]</span>, Nc <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="va">interim_A_allcombined_2</span></span></code></pre></div>
<pre><code><span><span class="co">## EM for Normal Mixture Model</span></span>
<span><span class="co">## Log-Likelihood = 10763.73</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Univariate normal mixture</span></span>
<span><span class="co">## Mixture Components:</span></span>
<span><span class="co">##   comp1       comp2       comp3       comp4       comp5      </span></span>
<span><span class="co">## w  0.22608509  0.22287087  0.22104424  0.19134605  0.13865375</span></span>
<span><span class="co">## m -0.22358073 -0.31478209 -0.11546035 -0.32415990 -0.01378153</span></span>
<span><span class="co">## s  0.05767847  0.12976158  0.06117267  0.07871764  0.09025686</span></span></code></pre>
<p>Now let’s overlay the two posterior’s</p>
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>logHR <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.8</span>, <span class="fl">0.25</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">logHR</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_function.html" class="external-link">stat_function</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">dmix</span>, args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mix <span class="op">=</span> <span class="va">interim_A_combined_2</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>linetype <span class="op">=</span> <span class="st">"MAP"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_function.html" class="external-link">stat_function</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">dmix</span>, args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mix <span class="op">=</span> <span class="va">interim_A_allcombined_2</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>linetype <span class="op">=</span> <span class="st">"MAC"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_linetype.html" class="external-link">scale_linetype_discrete</a></span><span class="op">(</span><span class="st">"Analysis"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Posterior log hazard of phase III A trial at interim"</span><span class="op">)</span></span></code></pre></div>
<p><img src="PoS_codata_files/figure-html/unnamed-chunk-47-1.png" width="100%" style="display: block; margin: auto;"></p>
<p>The PoS is essentially the same</p>
<div class="sourceCode" id="cb98"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">interim_pos_A</span><span class="op">(</span><span class="va">interim_A_combined_2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.489214</span></span></code></pre>
<div class="sourceCode" id="cb100"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">interim_pos_A</span><span class="op">(</span><span class="va">interim_A_allcombined_2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.4943454</span></span></code></pre>
<div class="section level3">
<h3 id="formal-map-and-mac-equivalence">Formal MAP and MAC equivalence<a class="anchor" aria-label="anchor" href="#formal-map-and-mac-equivalence"></a>
</h3>
<p>The stated equivalence requires that the posterior of a trial
specific parameter</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>θ</mi><mo>⋆</mo></msub><mo stretchy="false" form="prefix">|</mo><msub><mi>y</mi><mo>⋆</mo></msub><mo>,</mo><msub><mi>y</mi><mi>H</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">p(\theta_\star|y_\star,y_H),</annotation></semantics></math></p>
<p>which is conditional on the trial specific data
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mo>⋆</mo></msub><annotation encoding="application/x-tex">y_\star</annotation></semantics></math><strong>and</strong> the historical data
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mi>H</mi></msub><annotation encoding="application/x-tex">y_H</annotation></semantics></math>
(MAC approach, joint use of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>H</mi></msub><mo>,</mo><msub><mi>y</mi><mo>⋆</mo></msub></mrow><annotation encoding="application/x-tex">y_H,y_\star</annotation></semantics></math>),
is equivalent to obtaining the MAP prior
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>θ</mi><mo>⋆</mo></msub><mo stretchy="false" form="prefix">|</mo><msub><mi>y</mi><mi>H</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">p(\theta_\star|y_H)</annotation></semantics></math>
based on the historical data and then analyzing the new trial with this
prior.</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>θ</mi><mo>⋆</mo></msub><mo stretchy="false" form="prefix">|</mo><msub><mi>y</mi><mo>⋆</mo></msub><mo>,</mo><msub><mi>y</mi><mi>H</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>∝</mo><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>θ</mi><mo>⋆</mo></msub><mo>,</mo><msub><mi>θ</mi><mi>H</mi></msub><mo stretchy="false" form="prefix">|</mo><msub><mi>y</mi><mo>⋆</mo></msub><mo>,</mo><msub><mi>y</mi><mi>H</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>∝</mo><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mo>⋆</mo></msub><mo>,</mo><msub><mi>y</mi><mi>H</mi></msub><mo stretchy="false" form="prefix">|</mo><msub><mi>θ</mi><mo>⋆</mo></msub><mo>,</mo><msub><mi>θ</mi><mi>H</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="0.167em"></mspace><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>θ</mi><mo>⋆</mo></msub><mo>,</mo><msub><mi>θ</mi><mi>H</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mo>⋆</mo></msub><mo stretchy="false" form="prefix">|</mo><msub><mi>θ</mi><mo>⋆</mo></msub><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="0.167em"></mspace><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mi>H</mi></msub><mo stretchy="false" form="prefix">|</mo><msub><mi>θ</mi><mi>H</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="0.167em"></mspace><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>θ</mi><mo>⋆</mo></msub><mo>,</mo><msub><mi>θ</mi><mi>H</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>∝</mo><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mo>⋆</mo></msub><mo stretchy="false" form="prefix">|</mo><msub><mi>θ</mi><mo>⋆</mo></msub><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="0.167em"></mspace><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>θ</mi><mo>⋆</mo></msub><mo>,</mo><msub><mi>θ</mi><mi>H</mi></msub><mo stretchy="false" form="prefix">|</mo><msub><mi>y</mi><mi>H</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>∝</mo><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mo>⋆</mo></msub><mo stretchy="false" form="prefix">|</mo><msub><mi>θ</mi><mo>⋆</mo></msub><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="0.167em"></mspace><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>θ</mi><mo>⋆</mo></msub><mo stretchy="false" form="prefix">|</mo><msub><mi>y</mi><mi>H</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
p(\theta_\star|y_\star,y_H) &amp;\propto p(\theta_\star,\theta_H|y_\star,y_H) \\
 &amp;\propto p(y_\star,y_H|\theta_\star,\theta_H) \,
 p(\theta_\star,\theta_H) \\ 
 &amp;= p(y_\star|\theta_\star) \, p(y_H|\theta_H) \,
 p(\theta_\star,\theta_H) \\ 
&amp;\propto p(y_\star|\theta_\star) \, p(\theta_\star,\theta_H|y_H) \\
&amp;\propto p(y_\star|\theta_\star) \, p(\theta_\star|y_H)
\end{aligned}
</annotation></semantics></math></p>
<p>The equivalence holds under the use of the meta-analytic model.</p>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>[1] Neuenschwander, B., Roychoudhury, S., &amp; Schmidli, H. (2016).
On the Use of Co-Data in Clinical Trials. Statistics in
Biopharmaceutical Research, 8(3), 345-354. </p>
<p>[2] 1. Schmidli H, Gsteiger S, Roychoudhury S, O’Hagan A,
Spiegelhalter D, Neuenschwander B. Robust meta-analytic-predictive
priors in clinical trials with historical control information.
Biometrics. 2014;70(4):1023-1032. </p>
</div>
<div class="section level2">
<h2 id="r-session-info">R Session Info<a class="anchor" aria-label="anchor" href="#r-session-info"></a>
</h2>
<div class="sourceCode" id="cb102"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## R version 4.4.2 (2024-10-31)</span></span>
<span><span class="co">## Platform: x86_64-pc-linux-gnu</span></span>
<span><span class="co">## Running under: Ubuntu 24.04.1 LTS</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">## BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">## LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.26.so;  LAPACK version 3.12.0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## locale:</span></span>
<span><span class="co">##  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       </span></span>
<span><span class="co">##  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   </span></span>
<span><span class="co">##  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          </span></span>
<span><span class="co">## [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## time zone: UTC</span></span>
<span><span class="co">## tzcode source: system (glibc)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## other attached packages:</span></span>
<span><span class="co">## [1] purrr_1.0.2      dplyr_1.1.4      bayesplot_1.11.1 ggplot2_3.5.1   </span></span>
<span><span class="co">## [5] knitr_1.49       RBesT_1.8-0     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##  [1] tensorA_0.36.2.1     sass_0.4.9           generics_0.1.3      </span></span>
<span><span class="co">##  [4] stringi_1.8.4        digest_0.6.37        magrittr_2.0.3      </span></span>
<span><span class="co">##  [7] evaluate_1.0.1       grid_4.4.2           mvtnorm_1.3-2       </span></span>
<span><span class="co">## [10] fastmap_1.2.0        plyr_1.8.9           jsonlite_1.8.9      </span></span>
<span><span class="co">## [13] pkgbuild_1.4.5       backports_1.5.0      Formula_1.2-5       </span></span>
<span><span class="co">## [16] gridExtra_2.3        QuickJSR_1.4.0       scales_1.3.0        </span></span>
<span><span class="co">## [19] codetools_0.2-20     textshaping_0.4.1    jquerylib_0.1.4     </span></span>
<span><span class="co">## [22] abind_1.4-8          cli_3.6.3            rlang_1.1.4         </span></span>
<span><span class="co">## [25] munsell_0.5.1        withr_3.0.2          cachem_1.1.0        </span></span>
<span><span class="co">## [28] yaml_2.3.10          StanHeaders_2.32.10  parallel_4.4.2      </span></span>
<span><span class="co">## [31] tools_4.4.2          rstan_2.32.6         inline_0.3.20       </span></span>
<span><span class="co">## [34] reshape2_1.4.4       rstantools_2.4.0     checkmate_2.3.2     </span></span>
<span><span class="co">## [37] colorspace_2.1-1     assertthat_0.2.1     posterior_1.6.0     </span></span>
<span><span class="co">## [40] vctrs_0.6.5          R6_2.5.1             matrixStats_1.4.1   </span></span>
<span><span class="co">## [43] stats4_4.4.2         lifecycle_1.0.4      stringr_1.5.1       </span></span>
<span><span class="co">## [46] fs_1.6.5             htmlwidgets_1.6.4    ragg_1.3.3          </span></span>
<span><span class="co">## [49] pkgconfig_2.0.3      desc_1.4.3           pkgdown_2.1.1       </span></span>
<span><span class="co">## [52] RcppParallel_5.1.9   pillar_1.10.0        bslib_0.8.0         </span></span>
<span><span class="co">## [55] gtable_0.3.6         loo_2.8.0            glue_1.8.0          </span></span>
<span><span class="co">## [58] Rcpp_1.0.13-1        systemfonts_1.1.0    xfun_0.49           </span></span>
<span><span class="co">## [61] tibble_3.2.1         tidyselect_1.2.1     farver_2.1.2        </span></span>
<span><span class="co">## [64] htmltools_0.5.8.1    labeling_0.4.3       rmarkdown_2.29      </span></span>
<span><span class="co">## [67] compiler_4.4.2       distributional_0.5.0</span></span></code></pre>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sebastian Weber.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
