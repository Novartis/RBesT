<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Meta-Analytic-Predictive Analysis for Generalized Linear Models — gMAP • RBesT</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Meta-Analytic-Predictive Analysis for Generalized Linear Models — gMAP"><meta name="description" content="Meta-Analytic-Predictive (MAP) analysis for generalized linear
models suitable for normal, binary, or Poisson data. Model
specification and overall syntax follows mainly
stats::glm() conventions."><meta property="og:description" content="Meta-Analytic-Predictive (MAP) analysis for generalized linear
models suitable for normal, binary, or Poisson data. Model
specification and overall syntax follows mainly
stats::glm() conventions."><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">RBesT</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.8-2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/customizing_plots.html">Customizing RBesT plots</a></li>
    <li><a class="dropdown-item" href="../articles/introduction_normal.html">RBesT for a Normal Endpoint</a></li>
    <li><a class="dropdown-item" href="../articles/introduction.html">Getting started with RBesT (binary)</a></li>
    <li><a class="dropdown-item" href="../articles/PoS_codata.html">Probability of Success with Co-Data</a></li>
    <li><a class="dropdown-item" href="../articles/PoS_interim.html">Probability of Success at an Interim Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/variances_MAP.html">Meta-Analytic-Predictive Priors for Variances</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Novartis/RBesT/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Meta-Analytic-Predictive Analysis for Generalized Linear Models</h1>
      <small class="dont-index">Source: <a href="https://github.com/Novartis/RBesT/blob/main/R/gMAP.R" class="external-link"><code>R/gMAP.R</code></a></small>
      <div class="d-none name"><code>gMAP.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Meta-Analytic-Predictive (MAP) analysis for generalized linear
models suitable for normal, binary, or Poisson data. Model
specification and overall syntax follows mainly
<code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">stats::glm()</a></code> conventions.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">gMAP</span><span class="op">(</span></span>
<span>  <span class="va">formula</span>,</span>
<span>  family <span class="op">=</span> <span class="va">gaussian</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">weights</span>,</span>
<span>  <span class="va">offset</span>,</span>
<span>  <span class="va">tau.strata</span>,</span>
<span>  tau.dist <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"HalfNormal"</span>, <span class="st">"TruncNormal"</span>, <span class="st">"Uniform"</span>, <span class="st">"Gamma"</span>, <span class="st">"InvGamma"</span>, <span class="st">"LogNormal"</span>,</span>
<span>    <span class="st">"TruncCauchy"</span>, <span class="st">"Exp"</span>, <span class="st">"Fixed"</span><span class="op">)</span>,</span>
<span>  <span class="va">tau.prior</span>,</span>
<span>  tau.strata.pred <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  <span class="va">beta.prior</span>,</span>
<span>  prior_PD <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  REdist <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"normal"</span>, <span class="st">"t"</span><span class="op">)</span>,</span>
<span>  t.df <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  contrasts <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  iter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"RBesT.MC.iter"</span>, <span class="fl">6000</span><span class="op">)</span>,</span>
<span>  warmup <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"RBesT.MC.warmup"</span>, <span class="fl">2000</span><span class="op">)</span>,</span>
<span>  thin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"RBesT.MC.thin"</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>  init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"RBesT.MC.init"</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  chains <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"RBesT.MC.chains"</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>  cores <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"mc.cores"</span>, <span class="fl">1L</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'gMAP'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">x</span>, digits <span class="op">=</span> <span class="fl">3</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span><span class="op">)</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'gMAP'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">object</span>, type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"response"</span>, <span class="st">"link"</span><span class="op">)</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span><span class="op">)</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'gMAP'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">object</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span><span class="op">)</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'gMAP'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'gMAP'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"response"</span>, <span class="st">"link"</span><span class="op">)</span>,</span>
<span>  probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-formula">formula<a class="anchor" aria-label="anchor" href="#arg-formula"></a></dt>
<dd><p>the model formula describing the linear predictor
and encoding the grouping; see details</p></dd>


<dt id="arg-family">family<a class="anchor" aria-label="anchor" href="#arg-family"></a></dt>
<dd><p>defines data likelihood and link function
(<code>binomial</code>, <code>gaussian</code>, or <code>poisson</code>)</p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>optional data frame containing the variables of the
model. If not found in <code>data</code>, the variables are taken
from <code>environment(formula)</code>.</p></dd>


<dt id="arg-weights">weights<a class="anchor" aria-label="anchor" href="#arg-weights"></a></dt>
<dd><p>optional weight vector; see details below.</p></dd>


<dt id="arg-offset">offset<a class="anchor" aria-label="anchor" href="#arg-offset"></a></dt>
<dd><p>offset term in statistical model used for Poisson
data</p></dd>


<dt id="arg-tau-strata">tau.strata<a class="anchor" aria-label="anchor" href="#arg-tau-strata"></a></dt>
<dd><p>sets the exchangability stratum per study. That
is, it is expected that each study belongs to a single
stratum. Default is to assign all studies to stratum 1. See
section differential heterogeniety below.</p></dd>


<dt id="arg-tau-dist">tau.dist<a class="anchor" aria-label="anchor" href="#arg-tau-dist"></a></dt>
<dd><p>type of prior distribution for <code>tau</code>;
supported priors are <code>HalfNormal</code> (default),
<code>TruncNormal</code>, <code>Uniform</code>, <code>Gamma</code>,
<code>InvGamma</code>, <code>LogNormal</code>, <code>TruncCauchy</code>,
<code>Exp</code> and <code>Fixed</code>.</p></dd>


<dt id="arg-tau-prior">tau.prior<a class="anchor" aria-label="anchor" href="#arg-tau-prior"></a></dt>
<dd><p>parameters of prior distribution for <code>tau</code>;
see section prior specification below.</p></dd>


<dt id="arg-tau-strata-pred">tau.strata.pred<a class="anchor" aria-label="anchor" href="#arg-tau-strata-pred"></a></dt>
<dd><p>the index for the prediction stratum;
default is 1.</p></dd>


<dt id="arg-beta-prior">beta.prior<a class="anchor" aria-label="anchor" href="#arg-beta-prior"></a></dt>
<dd><p>mean and standard deviation for normal priors of
regression coefficients, see section prior specification below.</p></dd>


<dt id="arg-prior-pd">prior_PD<a class="anchor" aria-label="anchor" href="#arg-prior-pd"></a></dt>
<dd><p>logical to indicate if the prior predictive
distribution should be sampled (no conditioning on the
data). Defaults to <code>FALSE</code>.</p></dd>


<dt id="arg-redist">REdist<a class="anchor" aria-label="anchor" href="#arg-redist"></a></dt>
<dd><p>type of random effects distribution. <code>Normal</code>
(default) or <code>t</code>.</p></dd>


<dt id="arg-t-df">t.df<a class="anchor" aria-label="anchor" href="#arg-t-df"></a></dt>
<dd><p>degrees of freedom if random-effects distribution is
<code>t</code>.</p></dd>


<dt id="arg-contrasts">contrasts<a class="anchor" aria-label="anchor" href="#arg-contrasts"></a></dt>
<dd><p>an optional list; See <code>contrasts.arg</code> from
<code><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">stats::model.matrix.default()</a></code>.</p></dd>


<dt id="arg-iter">iter<a class="anchor" aria-label="anchor" href="#arg-iter"></a></dt>
<dd><p>number of iterations (including warmup).</p></dd>


<dt id="arg-warmup">warmup<a class="anchor" aria-label="anchor" href="#arg-warmup"></a></dt>
<dd><p>number of warmup iterations.</p></dd>


<dt id="arg-thin">thin<a class="anchor" aria-label="anchor" href="#arg-thin"></a></dt>
<dd><p>period of saving samples.</p></dd>


<dt id="arg-init">init<a class="anchor" aria-label="anchor" href="#arg-init"></a></dt>
<dd><p>positive number to specify uniform range on
unconstrained space for random initialization. See
<code><a href="https://mc-stan.org/rstan/reference/stan.html" class="external-link">stan</a></code>.</p></dd>


<dt id="arg-chains">chains<a class="anchor" aria-label="anchor" href="#arg-chains"></a></dt>
<dd><p>number of Markov chains.</p></dd>


<dt id="arg-cores">cores<a class="anchor" aria-label="anchor" href="#arg-cores"></a></dt>
<dd><p>number of cores for parallel sampling of chains.</p></dd>


<dt id="arg-x-object">x, object<a class="anchor" aria-label="anchor" href="#arg-x-object"></a></dt>
<dd><p><code>gMAP</code> analysis object created by <code>gMAP</code>
function</p></dd>


<dt id="arg-digits">digits<a class="anchor" aria-label="anchor" href="#arg-digits"></a></dt>
<dd><p>number of displayed significant digits.</p></dd>


<dt id="arg-probs">probs<a class="anchor" aria-label="anchor" href="#arg-probs"></a></dt>
<dd><p>defines quantiles to be reported.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>optional arguments are ignored</p></dd>


<dt id="arg-type">type<a class="anchor" aria-label="anchor" href="#arg-type"></a></dt>
<dd><p>sets reported scale (<code>response</code> (default) or
<code>link</code>).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>The function returns a S3 object of type <code>gMAP</code>. See
the methods section below for applicable functions to query the
object.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The meta-analytic-predictive (MAP) approach derives a prior from
historical data using a hierarchical model.  The statistical model is
formulated as a generalized linear mixed model for binary, normal
(with fixed \(\sigma\)) and Poisson endpoints:</p>
<p>$$y_{ih}|\theta_{ih} \sim f(y_{ih} | \theta_{ih})$$</p>
<p>Here, \(i=1,\ldots,N\) is the index for observations, and
\(h=1,\ldots,H\) is the index for the grouping (usually studies).
The model assumes the linear predictor for a transformed mean as</p>
<p>$$g(\theta_{ih}; x_{ih},\beta) = x_{ih} \, \beta + \epsilon_h$$</p>
<p>with \(x_{ih}\) being the row vector of \(k\) covariates for
observation \(i\).  The variance component is assumed by default
normal</p>
<p>$$\epsilon_h \sim N(0,\tau^2), \qquad h=1,\ldots,H$$</p>
<p>Lastly, the Bayesian implementation assumes independent normal
priors for the \(k\) regression coefficients and a prior for the
between-group standard deviation \(\tau\) (see <code>taud.dist</code>
for available distributions).</p>
<p>The MAP prior will then be derived from the above model as the
conditional distribution of \(\theta_{\star}\) given the
available data and the vector of covariates \(x_{\star}\)
defining the overall intercept</p>
<p>$$\theta_{\star}| x_{\star},y .$$</p>
<p>A simple and common case arises for one observation (summary
statistic) per trial. For a normal endpoint, the model then simplifies
to the standard normal-normal hierarchical model. In the above
notation, \(i=h=1,\ldots,H\) and</p>
<p>$$y_h|\theta_h \sim N(\theta_h,s_h^2)$$
$$\theta_h = \mu + \epsilon_h$$
$$\epsilon_h \sim N(0,\tau^2),$$</p>
<p>where the more common \(\mu\) is used for the only (intercept)
parameter \(\beta_1\). Since there are no covariates, the MAP
prior is simply \(Pr(\theta_{\star} |
y_1,\ldots,y_H)\).</p>
<p>The hierarchical model is a compromise between the two extreme
cases of full pooling (\(\tau=0\), full borrowing, no
discounting) and no pooling (\(\tau=\infty\), no borrowing,
stratification). The information content of the
historical data grows with H (number of historical data items)
indefinitely for full pooling whereas no information is
gained in a stratified analysis. For a fixed
\(\tau\), the maximum effective sample
size of the MAP prior is \(n_\infty\) (\(H\rightarrow
\infty\)), which for a normal endpoint with fixed
\(\sigma\) is</p>
<p>$$n_\infty = \left(\frac{\tau^2}{\sigma^2}\right)^{-1},$$</p>
<p>(<em>Neuenschwander et al., 2010</em>). Hence, the ratio
\(\tau/\sigma\) limits the amount of information a MAP prior is
equivalent to. This allows for a classification of \(\tau\)
values in relation to \(\sigma\), which is crucial to define a
prior \(P_\tau\). The following classification is useful in a
clinical trial setting:</p>
<table class="table table"><tr><td>Heterogeneity</td><td>\(\tau/\sigma\)</td><td>\(n_\infty\)</td></tr><tr><td>small</td><td>0.0625</td><td>256</td></tr><tr><td>moderate</td><td>0.125</td><td>64</td></tr><tr><td>substantial</td><td>0.25</td><td>16</td></tr><tr><td>large</td><td>0.5</td><td>4</td></tr><tr><td>very large</td><td>1.0</td><td>1</td></tr></table><p>The above formula for \(n_\infty\) assumes a known
\(\tau\). This is unrealistic as the between-trial heterogeneity
parameter is often not well estimable, in particular if the number
of trials is small (H small). The above table helps to specify a
prior distribution for \(\tau\) appropriate for the given context
which defines the crucial parameter \(\sigma\). For binary and
Poisson endpoints, normal approximations can be used to determine
\(\sigma\). See examples below for concrete cases.</p>
<p>The design matrix \(X\) is defined by the formula for the linear
predictor and is always of the form <code>response ~ predictor | grouping</code>, which follows <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">stats::glm()</a></code>
conventions. The syntax has been extended to include a
specification of the grouping (for example study) factor of the
data with a horizontal bar, <code>|</code>. The bar separates the
optionally specified grouping level, i.e. in the binary endpoint
case <code>cbind(r, n-r) ~ 1 | study</code>. By default it is assumed
that each row corresponds to an individual group (for which an
individual parameter is estimated). Specifics for the different
endpoints are:</p>
<dl><dt>normal</dt>
<dd><p><code>family=gaussian</code> assumes an identity link
function. The <code>response</code> should be given as matrix with two
columns with the first column being the observed mean value
\(y_{ih}\) and the second column the standard error
\(se_{ih}\) (of the mean). Additionally, it is recommended
to specify with the <code>weight</code> argument the number of units
which contributed to the (mean) measurement
\(y_{ih}\). This information is used to estimate
\(\sigma\).</p></dd>


<dt>binary</dt>
<dd><p><code>family=binomial</code> assumes a logit link
function. The <code>response</code> must be given as two-column matrix
with number of responders \(r\) (first column) and non-responders
\(n-r\) (second column).</p></dd>


<dt>Poisson</dt>
<dd><p><code>family=poisson</code> assumes a log link
function. The <code>response</code> is a vector of counts. The total
exposure times can be specified by an <code>offset</code>, which will be
linearly added to the linear predictor. The <code>offset</code> can be
given as part of the formula, <code>y ~ 1 + offset(log(exposure))</code>
or as the <code>offset</code> argument to <code>gMAP</code>. Note that the
exposure unit must be given as log-offset.</p></dd>



</dl></div>
    <div class="section level2">
    <h2 id="methods-by-generic-">Methods (by generic)<a class="anchor" aria-label="anchor" href="#methods-by-generic-"></a></h2>

<ul><li><p><code>print(gMAP)</code>: displays a summary of the gMAP analysis.</p></li>
<li><p><code>fitted(gMAP)</code>: returns the quantiles of the posterior shrinkage
estimates for each data item used during the analysis of the given
<code>gMAP</code> object.</p></li>
<li><p><code>coef(gMAP)</code>: returns the quantiles of the predictive
distribution. User can choose with <code>type</code> if the result is on
the response or the link scale.</p></li>
<li><p><code>as.matrix(gMAP)</code>: extracts the posterior sample of the model.</p></li>
<li><p><code>summary(gMAP)</code>: returns the summaries of a gMAP.
analysis. Output is a <code>gMAPsummary</code> object, which is a list containing</p><dl><dt><code>tau</code></dt>
<dd><p>posterior summary of the heterogeneity standard deviation</p></dd>

<dt><code>beta</code></dt>
<dd><p>posterior summary of the regression coefficients</p></dd>

<dt><code>theta.pred</code></dt>
<dd><p>summary of the predictive distribution (given in dependence on the <code>type</code> argument either on <code>response</code> or <code>link</code> scale)</p></dd>

<dt><code>theta</code></dt>
<dd><p>posterior summary of the mean estimate (also depends on the <code>type</code> argument)</p></dd>


</dl></li>
</ul></div>
    <div class="section level2">
    <h2 id="differential-discounting">Differential Discounting<a class="anchor" aria-label="anchor" href="#differential-discounting"></a></h2>



<p>The above model assumes the same between-group standard deviation
\(\tau\), which implies that the data are equally relevant. This
assumption can be relaxed to more than one \(\tau\). That is,</p>
<p>$$\epsilon_h \sim N(0,\tau_{s(h)}^2)$$</p>
<p>where \(s(h)\) assignes group \(h\) to one of \(S\)
between-group heterogeneity strata.</p>
<p>For example, in a situation with two randomized and four
observational studies, one may want to assume \(\tau_1\) (for
trials 1 and 2) and \(\tau_2\) (for trials 3-6) for the
between-trial standard deviations of the control means. More
heterogeneity (less relevance) for the observational studies can
then be expressed by appropriate priors for \(\tau_1\) and
\(\tau_2\). In this case, \(S=2\) and the strata assignments
(see <code>tau.strata</code> argument) would be \(s(1)=s(2)=1,
s(3)=\ldots=s(6)=2\).</p>
    </div>
    <div class="section level2">
    <h2 id="prior-specification">Prior Specification<a class="anchor" aria-label="anchor" href="#prior-specification"></a></h2>



<p>The prior distribution for the regression coefficients \(\beta\)
is normal.</p>
<ul><li><p>If a single number is given, then this is used as the standard
deviation and the default mean of 0 is used.</p></li>
<li><p>If a vector is given, it must be of the same length
as number of covariates defined and is used as standard
deviation.</p></li>
<li><p>If a matrix with a single row is given, its first row will be
used as mean and the second row will be used as standard deviation
for all regression coefficients.</p></li>
<li><p>Lastly, a two-column matrix (mean and standard deviation columns)
with as many columns as regression coefficients can be given.</p></li>
</ul><p>It is recommended to always specify a <code>beta.prior</code>. Per
default a mean of 0 is set. The standard deviation is set to 2 for
the binary case, to 100 * <code>sd(y)</code> for the normal case and to
<code>sd(log(y + 0.5 + offset))</code> for the Poisson case.</p>
<p>For the between-trial heterogeniety \(\tau\) prior, a dispersion
parameter must always be given for each exchangeability
stratum. For the different <code>tau.prior</code> distributions, two
parameters are needed out of which one is set to a default value if
applicable:</p>
<table class="table table"><tr><td>Prior</td><td>\(a\)</td><td>\(b\)</td><td>default</td></tr><tr><td><code>HalfNormal</code></td><td>\(\mu = 0\)</td><td>\(\sigma\)</td><td></td></tr><tr><td><code>TruncNormal</code></td><td>\(\mu\)</td><td>\(\sigma\)</td><td>\(\mu = 0\)</td></tr><tr><td><code>Uniform</code></td><td>a</td><td>b</td><td>a = 0</td></tr><tr><td><code>Gamma</code></td><td>\(\alpha\)</td><td>\(\beta\)</td><td></td></tr><tr><td><code>InvGamma</code></td><td>\(\alpha\)</td><td>\(\beta\)</td><td></td></tr><tr><td><code>LogNormal</code></td><td>\(\mu_{\log}\)</td><td>\(\sigma_{\log}\)</td><td></td></tr><tr><td><code>TruncCauchy</code></td><td>\(\mu\)</td><td>\(\sigma\)</td><td>\(\mu = 0\)</td></tr><tr><td><code>Exp</code></td><td>\(\beta\)</td><td>0</td><td></td></tr><tr><td><code>Fixed</code></td><td>a</td><td>0</td><td></td></tr></table><p>For a prior distribution with a default location parameter, a
vector of length equal to the number of exchangability strata can
be given. Otherwise, a two-column matrix with as many rows as
exchangability strata must be given, except for a single \(\tau\)
stratum, for which a vector of length two defines the parameters a
and b.</p>
    </div>
    <div class="section level2">
    <h2 id="random-seed">Random seed<a class="anchor" aria-label="anchor" href="#random-seed"></a></h2>
    <p>The MAP analysis is performed using
Markov-Chain-Monte-Carlo (MCMC) in <code><a href="https://mc-stan.org/rstan/reference/rstan.html" class="external-link">rstan::rstan()</a></code>. MCMC
is a stochastic algorithm. To obtain exactly reproducible results
you must use the <code><a href="https://rdrr.io/r/base/Random.html" class="external-link">base::set.seed()</a></code> function
before calling <code>gMAP</code>. See <code><a href="RBesT-package.html">RBesT()</a></code>
overview page for global options on setting further MCMC simulation
parameters.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Neuenschwander B, Capkun-Niggli G, Branson M,
Spiegelhalter DJ. Summarizing historical information on controls in
clinical trials. <em>Clin Trials</em>. 2010; 7(1):5-18</p>
<p>Schmidli H, Gsteiger S, Roychoudhury S, O'Hagan A, Spiegelhalter D,
Neuenschwander B.  Robust meta-analytic-predictive priors in
clinical trials with historical control information.
<em>Biometrics</em> 2014;70(4):1023-1032.</p>
<p>Weber S, Li Y, Seaman III J.W., Kakizume T, Schmidli H. Applying
Meta-Analytic Predictive Priors with the R Bayesian evidence
synthesis tools. <em>JSS</em> 2021; 100(19):1-32</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="plot.gMAP.html">plot.gMAP()</a></code>, <code><a href="forest_plot.html">forest_plot()</a></code>, <code><a href="automixfit.html">automixfit()</a></code>, <code><a href="predict.gMAP.html">predict.gMAP()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## Setting up dummy sampling for fast execution of example</span></span></span>
<span class="r-in"><span><span class="co">## Please use 4 chains and 20x more warmup &amp; iter in practice</span></span></span>
<span class="r-in"><span><span class="va">.user_mc_options</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>RBesT.MC.warmup<span class="op">=</span><span class="fl">50</span>, RBesT.MC.iter<span class="op">=</span><span class="fl">100</span>,</span></span>
<span class="r-in"><span>                            RBesT.MC.chains<span class="op">=</span><span class="fl">2</span>, RBesT.MC.thin<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Binary data example 1</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Mean response rate is ~0.25. For binary endpoints</span></span></span>
<span class="r-in"><span><span class="co"># a conservative choice for tau is a HalfNormal(0,1) as long as</span></span></span>
<span class="r-in"><span><span class="co"># the mean response rate is in the range of 0.2 to 0.8. For</span></span></span>
<span class="r-in"><span><span class="co"># very small or large rates consider the n_infinity approach</span></span></span>
<span class="r-in"><span><span class="co"># illustrated below.</span></span></span>
<span class="r-in"><span><span class="co"># for exact reproducible results, the seed must be set</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">34563</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">map_AS</span> <span class="op">&lt;-</span> <span class="fu">gMAP</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">r</span>, <span class="va">n</span> <span class="op">-</span> <span class="va">r</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">study</span>,</span></span>
<span class="r-in"><span>  family <span class="op">=</span> <span class="va">binomial</span>,</span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">AS</span>,</span></span>
<span class="r-in"><span>  tau.dist <span class="op">=</span> <span class="st">"HalfNormal"</span>, tau.prior <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>  beta.prior <span class="op">=</span> <span class="fl">2</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Assuming default prior location   for beta: 0</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>The largest R-hat is 1.11, indicating chains have not mixed.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> Running the chains for more iterations may help. See</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> https://mc-stan.org/misc/warnings.html#r-hat</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> Running the chains for more iterations may help. See</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> https://mc-stan.org/misc/warnings.html#bulk-ess</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> Running the chains for more iterations may help. See</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> https://mc-stan.org/misc/warnings.html#tail-ess</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Maximal Rhat &gt; 1.1. Consider increasing RBesT.MC.warmup MCMC parameter.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Final MCMC sample equivalent to less than 1000 independent draws.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Please consider increasing the MCMC simulation size.</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">map_AS</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Generalized Meta Analytic Predictive Prior Analysis</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:  gMAP(formula = cbind(r, n - r) ~ 1 | study, family = binomial, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     data = AS, tau.dist = "HalfNormal", tau.prior = 1, beta.prior = 2)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Exchangeability tau strata: 1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Prediction tau stratum    : 1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Maximal Rhat              : 1.11 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Between-trial heterogeneity of tau prediction stratum</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  mean    sd  2.5%   50% 97.5% </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.370 0.163 0.110 0.352 0.764 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MAP Prior MCMC sample</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   mean     sd   2.5%    50%  97.5% </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.2580 0.0817 0.1230 0.2510 0.4460 </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Parts of the model have not converged (some Rhats are &gt; 1.1).</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> Be careful when analysing the results! It is recommend to run</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> more iterations and/or setting stronger priors.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># obtain numerical summaries</span></span></span>
<span class="r-in"><span><span class="va">map_sum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">map_AS</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">map_sum</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Heterogeneity parameter tau per stratum:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        mean    sd 2.5%   50% 97.5%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> tau[1] 0.37 0.163 0.11 0.352 0.764</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Regression coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              mean    sd  2.5%   50%  97.5%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept) -1.12 0.178 -1.47 -1.11 -0.767</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mean estimate MCMC sample:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             mean    sd  2.5%   50% 97.5%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta_resp 0.248 0.033 0.187 0.247 0.317</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MAP Prior MCMC sample:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                  mean     sd  2.5%   50% 97.5%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta_resp_pred 0.258 0.0817 0.123 0.251 0.446</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">map_sum</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "tau"        "beta"       "theta.pred" "theta"     </span>
<span class="r-in"><span><span class="co"># [1] "tau"        "beta"       "theta.pred" "theta"</span></span></span>
<span class="r-in"><span><span class="va">map_sum</span><span class="op">$</span><span class="va">theta.pred</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                      mean         sd      2.5%       50%     97.5%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta_resp_pred 0.2576768 0.08166927 0.1232554 0.2508299 0.4464658</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="co"># graphical model checks (returns list of ggplot2 plots)</span></span></span>
<span class="r-in"><span><span class="va">map_checks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">map_AS</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># forest plot with shrinkage estimates</span></span></span>
<span class="r-in"><span><span class="va">map_checks</span><span class="op">$</span><span class="va">forest_model</span></span></span>
<span class="r-plt img"><img src="gMAP-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># density of MAP prior on response scale</span></span></span>
<span class="r-in"><span><span class="va">map_checks</span><span class="op">$</span><span class="va">densityThetaStar</span></span></span>
<span class="r-plt img"><img src="gMAP-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># density of MAP prior on link scale</span></span></span>
<span class="r-in"><span><span class="va">map_checks</span><span class="op">$</span><span class="va">densityThetaStarLink</span></span></span>
<span class="r-plt img"><img src="gMAP-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># obtain shrinkage estimates</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">map_AS</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              mean         sd       2.5%       50%     97.5%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Study 1 0.2245230 0.03009877 0.16467408 0.2255518 0.2698386</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Study 2 0.2600974 0.05160094 0.17318985 0.2610201 0.3745415</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Study 3 0.3157218 0.06628311 0.21188389 0.3041774 0.4656744</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Study 4 0.2440305 0.04812868 0.15154707 0.2442546 0.3333963</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Study 5 0.2681039 0.03179363 0.21285005 0.2633981 0.3412085</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Study 6 0.2670423 0.05109495 0.19112391 0.2609730 0.3660353</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Study 7 0.1704818 0.04185255 0.08821842 0.1727647 0.2466163</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Study 8 0.2649455 0.04246509 0.20001270 0.2574109 0.3462487</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># regression coefficients</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">map_AS</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 mean        sd      2.5%       50%      97.5%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept) -1.11748 0.1782488 -1.468582 -1.113787 -0.7667301</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># finally fit MAP prior with parametric mixture</span></span></span>
<span class="r-in"><span><span class="va">map_mix</span> <span class="op">&lt;-</span> <span class="fu"><a href="mixfit.html">mixfit</a></span><span class="op">(</span><span class="va">map_AS</span>, Nc <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">map_mix</span><span class="op">)</span><span class="op">$</span><span class="va">mix</span></span></span>
<span class="r-plt img"><img src="gMAP-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="co"># optionally select number of components automatically via AIC</span></span></span>
<span class="r-in"><span><span class="va">map_automix</span> <span class="op">&lt;-</span> <span class="fu"><a href="automixfit.html">automixfit</a></span><span class="op">(</span><span class="va">map_AS</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">map_automix</span><span class="op">)</span><span class="op">$</span><span class="va">mix</span></span></span>
<span class="r-plt img"><img src="gMAP-5.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Normal example 2, see normal vignette</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Prior considerations</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The general principle to derive a prior for tau can be based on the</span></span></span>
<span class="r-in"><span><span class="co"># n_infinity concept as discussed in Neuenschwander et al., 2010.</span></span></span>
<span class="r-in"><span><span class="co"># This assumes a normal approximation which applies for the colitis</span></span></span>
<span class="r-in"><span><span class="co"># data set as:</span></span></span>
<span class="r-in"><span><span class="va">p_bar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">colitis</span>, <span class="va">r</span> <span class="op">/</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">p_bar</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">p_bar</span><span class="op">)</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># s is the approximate sampling standard deviation and a</span></span></span>
<span class="r-in"><span><span class="co"># conservative prior is tau ~ HalfNormal(0,s/2)</span></span></span>
<span class="r-in"><span><span class="va">tau_prior_sd</span> <span class="op">&lt;-</span> <span class="va">s</span> <span class="op">/</span> <span class="fl">2</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Evaluate HalfNormal prior for tau</span></span></span>
<span class="r-in"><span><span class="va">tau_cat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  pooling <span class="op">=</span> <span class="fl">0</span>,</span></span>
<span class="r-in"><span>  small <span class="op">=</span> <span class="fl">0.0625</span>,</span></span>
<span class="r-in"><span>  moderate <span class="op">=</span> <span class="fl">0.125</span>,</span></span>
<span class="r-in"><span>  substantial <span class="op">=</span> <span class="fl">0.25</span>,</span></span>
<span class="r-in"><span>  large <span class="op">=</span> <span class="fl">0.5</span>,</span></span>
<span class="r-in"><span>  veryLarge <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>  stratified <span class="op">=</span> <span class="cn">Inf</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Interval probabilites (basically saying we are assuming</span></span></span>
<span class="r-in"><span><span class="co"># heterogeniety to be smaller than very large)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">pnorm</a></span><span class="op">(</span><span class="va">tau_cat</span> <span class="op">*</span> <span class="va">s</span>, <span class="fl">0</span>, <span class="va">tau_prior_sd</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       small    moderate substantial       large   veryLarge  stratified </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  0.09947645  0.09793620  0.18551227  0.29976457  0.27181024  0.04550026 </span>
<span class="r-in"><span><span class="co"># Cumulative probabilities as 1-F</span></span></span>
<span class="r-in"><span><span class="fl">1</span> <span class="op">-</span> <span class="fl">2</span> <span class="op">*</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">pnorm</a></span><span class="op">(</span><span class="va">tau_cat</span> <span class="op">*</span> <span class="va">s</span>, <span class="fl">0</span>, <span class="va">tau_prior_sd</span><span class="op">)</span> <span class="op">-</span> <span class="fl">0.5</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     pooling       small    moderate substantial       large   veryLarge </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1.00000000  0.90052355  0.80258735  0.61707508  0.31731051  0.04550026 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  stratified </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  0.00000000 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Recover user set sampling defaults</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span><span class="va">.user_mc_options</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sebastian Weber.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

