<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Mixture distributions as brms priors — mixstanvar • RBesT</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Mixture distributions as brms priors — mixstanvar"><meta name="description" content="Adapter function converting mixture distributions for
use with brms::brm() models via the
brms::stanvar() facility."><meta property="og:description" content="Adapter function converting mixture distributions for
use with brms::brm() models via the
brms::stanvar() facility."><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">RBesT</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.8-2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/customizing_plots.html">Customizing RBesT plots</a></li>
    <li><a class="dropdown-item" href="../articles/introduction_normal.html">RBesT for a Normal Endpoint</a></li>
    <li><a class="dropdown-item" href="../articles/introduction.html">Getting started with RBesT (binary)</a></li>
    <li><a class="dropdown-item" href="../articles/PoS_codata.html">Probability of Success with Co-Data</a></li>
    <li><a class="dropdown-item" href="../articles/PoS_interim.html">Probability of Success at an Interim Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/variances_MAP.html">Meta-Analytic-Predictive Priors for Variances</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Novartis/RBesT/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Mixture distributions as <code>brms</code> priors</h1>
      <small class="dont-index">Source: <a href="https://github.com/Novartis/RBesT/blob/main/R/mixstanvar.R" class="external-link"><code>R/mixstanvar.R</code></a></small>
      <div class="d-none name"><code>mixstanvar.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Adapter function converting mixture distributions for
use with <code><a href="https://paulbuerkner.com/brms/reference/brm.html" class="external-link">brms::brm()</a></code> models via the
<code><a href="https://paulbuerkner.com/brms/reference/stanvar.html" class="external-link">brms::stanvar()</a></code> facility.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">mixstanvar</span><span class="op">(</span><span class="va">...</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>List of mixtures to convert.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Enables printing of the mixture priors when chains
start to sample. Defaults to <code>FALSE</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p><code>stanvars</code> object to be used as argument to the
<code>stanvars</code> argument of a <code><a href="https://paulbuerkner.com/brms/reference/brm.html" class="external-link">brms::brm()</a></code> model.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>To declare mixture priors in a <code><a href="https://paulbuerkner.com/brms/reference/brm.html" class="external-link">brms::brm()</a></code>
model requires two steps: First, the mixture densities need to
be converted by the adapter function <code>mixstanvar</code> into a
<code>stanvars</code> object which is passed to the <code>stanvars</code>
argument of the <code><a href="https://paulbuerkner.com/brms/reference/brm.html" class="external-link">brms::brm()</a></code> function. Doing so
extends the Stan code and data generated by
<code><a href="https://paulbuerkner.com/brms/reference/brm.html" class="external-link">brms::brm()</a></code> such that the mixture densities can be
used as priors within the <code><a href="https://paulbuerkner.com/brms/reference/brm.html" class="external-link">brms::brm()</a></code> model. The
second step is to assign parameters of the
<code><a href="https://paulbuerkner.com/brms/reference/brm.html" class="external-link">brms::brm()</a></code> model to the mixture density as prior
using the <code><a href="https://paulbuerkner.com/brms/reference/set_prior.html" class="external-link">brms::set_prior()</a></code> command of <code>brms</code>.</p>
<p>The adapter function translates the mixture distributions as
defined in <code>R</code> to the respective mixture distribution in
Stan. Within Stan the mixture distributions are named in
accordance to the <code>R</code> functions used to create the respective
mixture distributions. That is, a mixture density of normals
created by <code><a href="mixnorm.html">mixnorm()</a></code> is referred to as
<code>mixnorm_lpdf</code> in Stan such that one can refer to the density
as <code>mixnorm</code> within the <code><a href="https://paulbuerkner.com/brms/reference/set_prior.html" class="external-link">brms::set_prior()</a></code>
functions (the suffix <code>_lpdf</code> is automatically added by
<code><a href="https://paulbuerkner.com/brms/reference/brm.html" class="external-link">brms::brm()</a></code>). The arguments to these mixture
distributions depend on the specific distribution type as follows:</p>
<table class="table table"><tr><td>Density</td><td>Arguments</td></tr><tr><td><code>mixbeta(w, a, b)</code></td><td><code>w</code> weights, <code>a</code> shapes, <code>b</code> shapes</td></tr><tr><td><code>mixgamma(w, a, b)</code></td><td><code>w</code> weights, <code>a</code> shapes, <code>b</code> inverse scales</td></tr><tr><td><code>mixnorm(w, m, s)</code></td><td><code>w</code> weights, <code>m</code> means, <code>s</code> standard deviations</td></tr><tr><td><code>mixmvnorm(w, m, sigma_L)</code></td><td><code>w</code> weights, <code>m</code> means, <code>sigma_L</code> cholesky factors of covariances</td></tr></table><p>These arguments to the mixture densities refer to the different
density parameters and are automatically extracted from the
mixtures when converted. Important here are the argument names as
these must be used to declare the mixture prior. For each mixture
to convert as part of the <code>...</code>  argument to <code>mixstanvar</code>
a label is determined using the name given in the list. In case no
name is given, then the name of the <code>R</code> object itself is
used. To declare a prior for a parameter the mixture distribution
must be used with it's arguments following the convention
<code>label_argument</code>. Please refer to the examples section for an
illustration.</p>
<p><strong>Note:</strong> Models created by <code><a href="https://paulbuerkner.com/brms/reference/brm.html" class="external-link">brms::brm()</a></code> do use by
default a data-dependent centering of covariates leading to a shift
of the overall intercept. This is commonly not desirable in
applications of this functionality. It is therefore strongly
recommended to pass the option <code>center=FALSE</code> as argument to
the <code>brms</code> formula created with the <code><a href="https://paulbuerkner.com/brms/reference/brmsformula.html" class="external-link">brms::bf()</a></code>
function as demonstrated with the example below.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># The mixstanvar adapter requires the optional packages brms and glue</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://github.com/paul-buerkner/brms" class="external-link">"brms"</a></span><span class="op">)</span>, <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://glue.tidyverse.org/" class="external-link">"glue"</a></span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Assume we prefer a logistic regression MCMC analysis rather than a</span></span></span>
<span class="r-in"><span><span class="co"># beta-binomial analysis for the responder endpoint of the ankylosing</span></span></span>
<span class="r-in"><span><span class="co"># spondylitis (AS) example. Reasons to prefer a regression analysis is</span></span></span>
<span class="r-in"><span><span class="co"># to allow for baseline covariate adjustments, for example.</span></span></span>
<span class="r-in"><span><span class="va">map_AS_beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="mixbeta.html">mixbeta</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.62</span>, <span class="fl">19.2</span>, <span class="fl">57.8</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.38</span>, <span class="fl">3.5</span>, <span class="fl">9.4</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># First we need to convert the beta mixture to a respective mixture on</span></span></span>
<span class="r-in"><span><span class="co"># the log odds scale and approximate it with a normal mixture density.</span></span></span>
<span class="r-in"><span><span class="va">map_AS_samp</span> <span class="op">&lt;-</span> <span class="fu"><a href="mix.html">rmix</a></span><span class="op">(</span><span class="va">map_AS_beta</span>, <span class="fl">1E4</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">map_AS</span> <span class="op">&lt;-</span> <span class="fu"><a href="mixfit.html">mixfit</a></span><span class="op">(</span><span class="fu"><a href="lodds.html">logit</a></span><span class="op">(</span><span class="va">map_AS_samp</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"norm"</span>, Nc <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Trial results for placebo and secukinumab.</span></span></span>
<span class="r-in"><span><span class="va">trial</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">24</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  r <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">15</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  arm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"placebo"</span>, <span class="st">"secukinumab"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define brms model such that the overall intercept corresponds to the</span></span></span>
<span class="r-in"><span><span class="co"># placebo response rate on the logit scale. NOTE: The use of</span></span></span>
<span class="r-in"><span><span class="co"># center=FALSE is required here as detailed in the note above.</span></span></span>
<span class="r-in"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://paulbuerkner.com/brms/reference/brmsformula.html" class="external-link">bf</a></span><span class="op">(</span><span class="va">r</span> <span class="op">|</span> <span class="fu">trials</span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">arm</span>, family <span class="op">=</span> <span class="va">binomial</span>, center <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># to obtain detailed information on the declared model parameters use</span></span></span>
<span class="r-in"><span><span class="co"># get_prior(model, data=trial)</span></span></span>
<span class="r-in"><span><span class="co"># declare model prior with reference to mixture normal map prior...</span></span></span>
<span class="r-in"><span><span class="va">model_prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://paulbuerkner.com/brms/reference/set_prior.html" class="external-link">prior</a></span><span class="op">(</span><span class="fu"><a href="mixnorm.html">mixnorm</a></span><span class="op">(</span><span class="va">map_w</span>, <span class="va">map_m</span>, <span class="va">map_s</span><span class="op">)</span>, coef <span class="op">=</span> <span class="va">Intercept</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://paulbuerkner.com/brms/reference/set_prior.html" class="external-link">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">b</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># ... which must be made available to brms using the mixstanvar adapter.</span></span></span>
<span class="r-in"><span><span class="co"># Note that the map_AS prior is labeled "map" as referred to in the</span></span></span>
<span class="r-in"><span><span class="co"># previous prior declaration.</span></span></span>
<span class="r-in"><span><span class="va">analysis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://paulbuerkner.com/brms/reference/brm.html" class="external-link">brm</a></span><span class="op">(</span><span class="va">model</span>,</span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">trial</span>, prior <span class="op">=</span> <span class="va">model_prior</span>,</span></span>
<span class="r-in"><span>  stanvars <span class="op">=</span> <span class="fu">mixstanvar</span><span class="op">(</span>map <span class="op">=</span> <span class="va">map_AS</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  seed <span class="op">=</span> <span class="fl">365634</span>, refresh <span class="op">=</span> <span class="fl">0</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Let's compare the logistic regression estimate for the probability</span></span></span>
<span class="r-in"><span><span class="co"># of a positive treatment effect (secukinumab response rate exceeding</span></span></span>
<span class="r-in"><span><span class="co"># the response rate of placebo) to the direct beta-binomial analysis:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://paulbuerkner.com/brms/reference/hypothesis.brmsfit.html" class="external-link">hypothesis</a></span><span class="op">(</span><span class="va">analysis</span>, <span class="st">"armsecukinumab &gt; 0"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">post_secukinumab</span> <span class="op">&lt;-</span> <span class="fu"><a href="postmix.html">postmix</a></span><span class="op">(</span><span class="fu"><a href="mixbeta.html">mixbeta</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>, r <span class="op">=</span> <span class="fl">15</span>, n <span class="op">=</span> <span class="fl">24</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">post_placebo</span> <span class="op">&lt;-</span> <span class="fu"><a href="postmix.html">postmix</a></span><span class="op">(</span><span class="va">map_AS_beta</span>, r <span class="op">=</span> <span class="fl">1</span>, n <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="mixdiff.html">pmixdiff</a></span><span class="op">(</span><span class="va">post_secukinumab</span>, <span class="va">post_placebo</span>, <span class="fl">0</span>, lower.tail <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># The posterior probability for a positive treatment effect</span></span></span>
<span class="r-in"><span><span class="co"># is very close to unity in both cases.</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sebastian Weber.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

